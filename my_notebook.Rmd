---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

# Einleitung

Dies ist ein toller Code!

```{r}
plot(cars)
```

```{r}
2+2
```

```{r}
summary(cars)
```
```{r}
hist(cars$speed)
```

# Sitzung 3

```{r}
library(tidyverse)
```

```{r}
library(nycflights23)
```
















```{r}
nummer <- 1:18
farbe <- c("rot","rot","rot","rot","orange","orange","orange","orange","grün","grün","grün","grün","dunkelrot","dunkelrot","rot","dunkelrot","gelb","gelb")
Gummibärchentüte <- data.frame(nummer,farbe)
Gummibärchentüte
```

```{r}
library(tidyverse)
```
```{r}
library(nycflights23)
```


```{r}
Gummibärchentüte %>%
  group_by(farbe) %>%
  summarise(Anzahl_pro_farbe = n()) %>%
  arrange(desc(Anzahl_pro_farbe))
```

```{r}
my_flights <- flights
```

```{r}
flights %>%
  group_by(origin) %>%
  summarise(Anzahl_Fluege_pro_Carrier = n())
```

```{r}
data <- flights %>%
  full_join(airlines) %>%
  full_join(airports, join_by("dest" == "faa")) %>%
  rename(airline_name = name.x, dest_name = name.y) 
```

```{r}
write_csv(data, "data.csv")
```

```{r}
data <- read_csv("data.csv")
```


```{r}
airports
```

```{r}
weather
```


```{r}
flights %>%
  group_by(dest) %>%
  summarise(Anzahl_destinations = n())
```


```{r}
airlines
```

# Sitzung 4

```{r}
flights %>%
  group_by(carrier) %>%
  mutate(number_of_flights = n()) %>%
  filter(arr_delay > 0) %>%
  mutate(number_of_delays = n()) %>%
  mutate(delay_ration = number_of_delays / number_of_flights) %>%
  select(carrier, number_of_delays, number_of_flights, delay_ration) %>%
  distinct() %>%
  arrange(desc(delay_ration)) %>%
  left_join(airlines) %>%
  rename(airline=name) %>%
  ggplot(. , aes(x = carrier, y = delay_ration)) +
  geom_col()

```

```{r}
# Benötigte Pakete laden
library(nycflights23)
library(dplyr)
library(ggplot2)

# Mittlere Ankunftsverspätung pro Fluggesellschaft berechnen
airline_delays <- flights %>%
  group_by(carrier) %>%
  summarise(mean_delay = mean(arr_delay, na.rm = TRUE)) %>%
  #filter(mean_delay > 0) %>%
  # Fluggesellschaftsnamen hinzufügen
  left_join(airlines, by = "carrier") %>%
  # Nach Verspätung sortieren
  arrange(mean_delay)

# Einen Vektor für Farben erstellen (alle grau außer ExpressJet, das hervorgehoben wird)
# ExpressJet hat im Datensatz den Code "EV"
farben <- ifelse(airline_delays$carrier == "G4", "#B22222", "#AAAAAA")

# Horizontalen Balkenplot erstellen
ggplot(airline_delays, aes(x = reorder(name, mean_delay), y = mean_delay)) +
  geom_col(fill = farben) +
  coord_flip() +  # Für horizontale Balken
  labs(
    title = "",
    x = "",
    y = "mean arrival delay (min.)"
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  )
```


```{r}
# Benötigte Pakete laden
library(nycflights23)
library(dplyr)
library(ggplot2)

# Daten filtern (nur positive Verspätungen) und vorbereiten
delay_data <- flights %>%
  left_join(airlines, by = "carrier")  # Fluggesellschaftsnamen hinzufügen

# Reihenfolge der Fluggesellschaften nach Median-Verspätung festlegen
carrier_order <- delay_data %>%
  group_by(carrier, name) %>%
  summarise(median_delay = median(arr_delay, na.rm = TRUE), .groups = "drop") %>%
  arrange(median_delay)

# Farben definieren (ExpressJet hervorgehoben, Rest grau)
# (Angenommen, Sie möchten ExpressJet hervorheben, das Code "EV" hat)
delay_data$color <- ifelse(delay_data$carrier == "G4", "#B22222", "#AAAAAA")

# Boxplot erstellen
ggplot(delay_data, aes(x = factor(name, levels = carrier_order$name), y = arr_delay)) +
  geom_boxplot(aes(fill = color), outlier.shape = NA, varwidth = TRUE) +  # outlier.shape = NA entfernt Ausreißer für bessere Lesbarkeit
  coord_flip() +  # Horizontale Boxplots
  scale_fill_identity() +  # Verwende die definierten Farben direkt
  scale_y_continuous(limits = c(-50, 150)) +  # Limitiere y-Achse für bessere Lesbarkeit
  labs(
    title = "Verteilung der Ankunftsverspätungen nach Fluggesellschaft",
    x = "",
    y = "arrival delay (min.)"
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  )
```













